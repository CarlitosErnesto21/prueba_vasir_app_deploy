import{A as Q}from"./AuthenticatedLayout-ySbiGZ3w.js";import{r as i,o as X,k as b,c as m,d as p,p as t,$ as T,a0 as Y,x as r,e as s,q as V,t as E,j as F,y as j,F as L,l as Z}from"./vendor-BOi6Gr0G.js";import{z as ee,F as ae,q as le,o as te}from"./ui-BibPgP1I.js";import"./logo-DN1bLr27.js";import"./index-Btbp3Gjs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"py-6 px-6 mt-10 mx-auto bg-red-50 shadow-md rounded-lg"},oe={class:"flex justify-between items-center mb-4"},ne={class:"flex justify-between items-center w-full"},ie={class:"flex justify-letf gap-2 w-full"},re={class:"p-fluid space-y-6"},ue={class:"w-full flex flex-col"},de={class:"flex items-center gap-4"},ce={key:0,class:"text-red-500 ml-28"},me={class:"w-full flex flex-col"},pe={class:"flex items-center gap-4"},ve={key:0,class:"text-red-500 ml-28"},fe={class:"w-full flex flex-col"},be={class:"flex items-center gap-4"},ge={key:0,class:"text-red-500 ml-28"},he={class:"flex gap-4 flex-wrap mt-4 ml-28"},ye=["src"],we=["onClick"],xe={class:"flex justify-center gap-4 w-full"},_e={key:0,class:"flex flex-col items-center justify-center"},Ce={class:"flex justify-center items-center w-full h-96"},ke=["src"],Ae={key:1,class:"text-center text-gray-500 py-8"},k="/api/aerolineas",B="/storage/aerolinea/",$e={__name:"Aerolineas",setup(Ie){const v=ee(),S=i([]),o=i({id:null,nombre:"",fecha:null,imagenes:[]}),u=i([]),f=i([]),g=i([]),U=i(),h=i(!1),y=i(!1),c=i(!1),A=i({global:{value:null,matchMode:ae.CONTAINS}}),_=i("Guardar"),C=i(!1),w=i([]);X(()=>{I()});const I=async()=>{try{const a=await axios.get(k);S.value=a.data.map(e=>({...e,imagenes:(e.imagenes||[]).map(d=>typeof d=="string"?d:d.nombre)}))}catch{v.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las aerolíneas",life:4e3})}},M=()=>{o.value={id:null,nombre:"",fecha:null,imagenes:[]},u.value=[],f.value=[],g.value=[],c.value=!1,_.value="Guardar",h.value=!0},z=a=>{o.value={...a},f.value=[],_.value="Actualizar",h.value=!0,u.value=Array.isArray(a.imagenes)?a.imagenes.map(e=>typeof e=="string"?e:e.nombre):[],g.value=[]},O=async()=>{if(c.value=!0,!(!o.value.nombre||!o.value.fecha)){if(u.value.length===0){v.add({severity:"error",summary:"Error",detail:"Debes subir al menos una imagen.",life:4e3});return}try{const a=new FormData;a.append("nombre",String(o.value.nombre));let e=o.value.fecha;e&&typeof e=="object"&&typeof e.toISOString=="function"?e=e.toISOString().split("T")[0]:typeof e=="string"?e=e:e="",a.append("fecha",e),f.value.forEach(n=>{a.append("imagenes[]",n)}),g.value.forEach(n=>{a.append("removed_images[]",n.split("/").pop())});let d;o.value.id?(a.append("_method","PUT"),d=await axios.post(`${k}/${o.value.id}`,a,{headers:{"Content-Type":"multipart/form-data"}}),v.add({severity:"info",summary:"Aerolínea actualizada",life:3e3})):(d=await axios.post(k,a,{headers:{"Content-Type":"multipart/form-data"}}),v.add({severity:"success",summary:"Aerolínea agregada",life:3e3})),await I(),h.value=!1,o.value={id:null,nombre:"",fecha:null,imagenes:[]},u.value=[],f.value=[],g.value=[],c.value=!1}catch{v.add({severity:"error",summary:"Error",detail:"No se pudo guardar la aerolínea.",life:4e3})}}},G=a=>{o.value={...a},y.value=!0},q=async()=>{try{await axios.delete(`${k}/${o.value.id}`),await I(),y.value=!1,v.add({severity:"success",summary:"Aerolínea eliminada",life:3e3})}catch{v.add({severity:"error",summary:"Error",detail:"No se pudo eliminar la aerolínea.",life:3e3})}},P=()=>{h.value=!1,u.value=[],f.value=[],g.value=[],c.value=!1},R=a=>{for(const e of a.files)if(e instanceof File){f.value.push(e);const d=new FileReader;d.onload=n=>{u.value.push(n.target.result)},d.readAsDataURL(e)}},W=a=>{const e=u.value[a];typeof e=="string"&&e.startsWith("data:image")?(u.value.splice(a,1),f.value.splice(a,1)):(g.value.push(e),u.value.splice(a,1))},H=a=>{w.value=(a||[]).map(e=>B+(typeof e=="string"?e:e.nombre)),C.value=!0};return(a,e)=>{const d=b("Toast"),n=b("Button"),$=b("InputText"),N=b("Column"),K=b("DataTable"),J=b("FileUpload"),D=b("Dialog");return p(),m(L,null,[t(T(Y),{title:"Aerolíneas"}),t(Q,null,{default:r(()=>[t(d),s("div",se,[s("div",oe,[e[9]||(e[9]=s("h3",{class:"text-lg font-bold"},"Gestión de Aerolíneas",-1)),t(n,{label:"Agregar aerolínea",icon:"pi pi-plus",class:"p-button-sm p-button-danger",onClick:M})]),t(K,{value:S.value,selection:U.value,"onUpdate:selection":e[1]||(e[1]=l=>U.value=l),dataKey:"id",filters:A.value,paginator:!0,rows:5,rowsPerPageOptions:[5,10,15],class:"w-full table-fixed"},{header:r(()=>[s("div",ne,[t($,{modelValue:A.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=l=>A.value.global.value=l),placeholder:"Buscar...",class:"w-full mr-4"},null,8,["modelValue"])])]),default:r(()=>[t(N,{field:"nombre",header:"Nombre",sortable:"",style:{width:"30%"}}),t(N,{field:"fecha",header:"Fecha",style:{width:"30%"}},{body:r(l=>[V(E(l.data.fecha?new Date(l.data.fecha).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):""),1)]),_:1}),t(N,{header:"Acciones",exportable:!1,style:{width:"20%",textAlign:"left"}},{body:r(l=>[s("div",ie,[t(n,{icon:"pi pi-eye",class:"p-button-rounded p-button-info p-button-md mr-2",onClick:x=>H(l.data.imagenes)},null,8,["onClick"]),t(n,{icon:"pi pi-pencil",class:"p-button-rounded p-button-warn p-button-md mr-2",onClick:x=>z(l.data)},null,8,["onClick"]),t(n,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger p-button-md",onClick:x=>G(l.data)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","selection","filters"]),t(D,{visible:h.value,"onUpdate:visible":e[4]||(e[4]=l=>h.value=l),header:_.value+" Aerolínea",modal:!0,style:{width:"400px"}},{footer:r(()=>[s("div",xe,[t(n,{label:"Cancelar",icon:"pi pi-times",class:"p-button-rounded p-button-danger p-button-md mr-2",text:"",onClick:P}),t(n,{label:_.value,icon:"pi pi-check",class:"p-button-rounded p-button-warn p-button-md mr-2",onClick:O},null,8,["label"])])]),default:r(()=>[s("div",re,[s("div",ue,[s("div",de,[e[10]||(e[10]=s("label",{for:"nombre",class:"w-24"},"Nombre:",-1)),t($,{modelValue:o.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.nombre=l),modelModifiers:{trim:!0},id:"nombre",class:j([{"p-invalid":c.value&&!o.value.nombre},"flex-1"])},null,8,["modelValue","class"])]),c.value&&!o.value.nombre?(p(),m("small",ce,"El nombre es obligatorio.")):F("",!0)]),s("div",me,[s("div",pe,[e[11]||(e[11]=s("label",{for:"fecha",class:"w-24"},"Fecha fundación:",-1)),t(T(le),{modelValue:o.value.fecha,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.fecha=l),id:"fecha",showIcon:!0,dateFormat:"yy-mm-dd",class:j([{"p-invalid":c.value&&!o.value.fecha},"flex-1"]),manualInput:!1},null,8,["modelValue","class"])]),c.value&&!o.value.fecha?(p(),m("small",ve,"La fecha es obligatoria.")):F("",!0)]),s("div",fe,[s("div",be,[e[12]||(e[12]=s("label",{for:"imagenes",class:"w-24"},"Imágenes:",-1)),t(J,{mode:"basic",name:"imagenes[]",accept:"image/*",auto:!0,chooseLabel:"Seleccionar imágenes",onSelect:R,customUpload:!0,multiple:!0,class:"flex-1 p-button-rounded p-button-warn p-button-md mr-2"})]),c.value&&u.value.length===0?(p(),m("small",ge,"Al menos una imagen es obligatoria.")):F("",!0)]),s("div",he,[(p(!0),m(L,null,Z(u.value,(l,x)=>(p(),m("div",{key:x,class:"relative w-24 h-24 group"},[s("img",{src:l.startsWith("data:image")?l:B+l,alt:"Vista previa",class:"w-full h-full object-cover rounded border"},null,8,ye),s("button",{onClick:Ne=>W(x),class:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 shadow",style:{"z-index":"2"}},e[13]||(e[13]=[s("i",{class:"pi pi-times text-xs"},null,-1)]),8,we)]))),128))])])]),_:1},8,["visible","header"]),t(D,{visible:y.value,"onUpdate:visible":e[6]||(e[6]=l=>y.value=l),header:"Confirmar",modal:!0,style:{width:"350px"}},{footer:r(()=>[t(n,{label:"No",icon:"pi pi-times",text:"",onClick:e[5]||(e[5]=l=>y.value=!1),class:"p-button-rounded p-button-warn p-button-md mr-2"}),t(n,{label:"Sí",icon:"pi pi-check",severity:"danger",onClick:q})]),default:r(()=>[s("span",null,[e[14]||(e[14]=V("¿Eliminar la aerolínea ")),s("b",null,E(o.value.nombre),1),e[15]||(e[15]=V("?"))])]),_:1},8,["visible"]),t(D,{visible:C.value,"onUpdate:visible":e[8]||(e[8]=l=>C.value=l),header:"Imágenes de la aerolínea",modal:!0,style:{width:"700px"}},{footer:r(()=>[t(n,{label:"Cerrar",icon:"pi pi-times",class:"p-button-rounded-md p-button-danger",onClick:e[7]||(e[7]=l=>C.value=!1)})]),default:r(()=>[w.value.length?(p(),m("div",_e,[t(T(te),{value:w.value,numVisible:1,numScroll:1,circular:!0,class:"w-full",showIndicators:w.value.length>1,showNavigators:w.value.length>1,style:{"max-width":"610px"}},{item:r(l=>[s("div",Ce,[s("img",{src:l.data,alt:"Imagen aerolínea",class:"w-auto h-full max-h-96 object-contain rounded shadow"},null,8,ke)])]),_:1},8,["value","showIndicators","showNavigators"])])):(p(),m("div",Ae," No hay imágenes para esta aerolínea. "))]),_:1},8,["visible"])])]),_:1})],64)}}};export{$e as default};
