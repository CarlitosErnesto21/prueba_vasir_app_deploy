import{d as A}from"./app-Dc3vrW6t.js";import{r as m,a4 as J,E as c}from"./vendor-BOi6Gr0G.js";const O=A("carrito",()=>{const t=m([]),o=m(!1),g=J(),v=c(()=>t.value.reduce((e,a)=>e+a.cantidad,0)),f=c(()=>t.value.reduce((e,a)=>e+a.precio*a.cantidad,0)),p=c(()=>t.value.length===0),S=e=>{const a=t.value.find(i=>i.id===e.id);a?a.cantidad+=1:t.value.push({id:e.id,nombre:e.nombre,precio:e.precio,imagen:e.imagen,stock_actual:e.stock_actual,cantidad:1}),r()},n=e=>{const a=t.value.findIndex(i=>i.id===e);a>-1&&(t.value.splice(a,1),r())},_=(e,a)=>{const i=t.value.find(P=>P.id===e);i&&(a<=0?n(e):a<=i.stock_actual&&(i.cantidad=a,r()))},C=e=>{const a=t.value.find(i=>i.id===e);a&&a.cantidad<a.stock_actual&&(a.cantidad+=1,r())},I=e=>{const a=t.value.find(i=>i.id===e);a&&(a.cantidad<=1?n(e):(a.cantidad-=1,r()))},h=()=>{t.value=[],r()},s=()=>{console.log("🚪 Usuario cerró sesión - Limpiando carrito"),t.value=[],o.value=!1,localStorage.removeItem("carrito_agencia_vasir")},l=()=>{var i;const e=(i=g.props.auth)==null?void 0:i.user,a=t.value.length>0;!e&&a&&(console.log("🔍 Usuario no autenticado detectado - Limpiando carrito"),s())},y=()=>{o.value=!o.value},E=()=>{o.value=!0},b=()=>{o.value=!1},r=()=>{localStorage.setItem("carrito_agencia_vasir",JSON.stringify(t.value))},d=()=>{const e=localStorage.getItem("carrito_agencia_vasir");if(e)try{t.value=JSON.parse(e),l()}catch(a){console.error("Error al cargar carrito desde localStorage:",a),t.value=[]}},u=e=>t.value.find(a=>a.id===e),k=e=>t.value.some(a=>a.id===e),x=e=>{const a=u(e);return a?a.cantidad:0};return d(),{items:t,isVisible:o,itemCount:v,totalPrice:f,isEmpty:p,agregarProducto:S,eliminarProducto:n,actualizarCantidad:_,incrementarCantidad:C,decrementarCantidad:I,limpiarCarrito:h,limpiarCarritoAlCerrarSesion:s,toggleVisibility:y,mostrarCarrito:E,ocultarCarrito:b,getItem:u,hasItem:k,getItemQuantity:x,cargarDesdeStorage:d,guardarEnStorage:r,verificarEstadoAutenticacion:l}});export{O as u};
