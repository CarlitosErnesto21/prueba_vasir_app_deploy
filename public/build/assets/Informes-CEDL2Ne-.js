import{r as m,E as D,o as _,ac as R,k as F,c as W,d as z,p as c,$ as x,a0 as B,x as N,e as o,v as I,a6 as U,y as O,q as A,F as H}from"./vendor-BOi6Gr0G.js";import{A as Y}from"./AuthenticatedLayout-ySbiGZ3w.js";import{z as G}from"./ui-BibPgP1I.js";import"./logo-DN1bLr27.js";import"./index-Btbp3Gjs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"min-h-[70vh] flex flex-col items-center justify-center py-4 px-2 sm:px-4 md:px-8 bg-gray-50"},q={class:"bg-white rounded-xl shadow-2xl border border-blue-100 px-3 py-4 sm:px-8 sm:py-10 w-full max-w-md sm:max-w-lg md:max-w-xl lg:max-w-2xl flex flex-col items-center gap-3"},K={class:"w-full flex flex-row items-center justify-between mb-2 gap-2"},Q={class:"flex items-center gap-2 flex-1"},X={class:"flex items-center gap-2 flex-1"},Z={class:"w-full mb-3 sm:mb-5"},ee={class:"w-full mb-2 flex flex-col sm:flex-row gap-2 sm:gap-4"},oe={class:"flex-1"},te={class:"flex-1"},se={class:"w-full flex flex-col sm:flex-row gap-2 sm:gap-3 mb-2 justify-center items-center"},ae=["disabled"],ce={__name:"Informes",setup(ne){const v=m(window.innerWidth);D(()=>v.value<768?"400":v.value<1024?"500":"700");const M=()=>{v.value=window.innerWidth};_(()=>{window.addEventListener("resize",M)}),R(()=>{window.removeEventListener("resize",M)});function T(){const a=[],e=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];let t=new Date(2022,0,1);const n=new Date;for(;t<=n;){const s=`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}`,f=`${e[t.getMonth()]} ${t.getFullYear()}`;a.push({value:s,label:f}),t.setMonth(t.getMonth()+1)}return a}const b=T(),r=m(null),d=m(null),g=new Date,l=m("unico"),u=m(null),$=m(null),C=G(),L=new Date(2019,2,1),w=a=>a?`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}`:"",S=D(()=>{if(!r.value||!d.value)return[];const a=w(r.value),e=w(d.value),t=b.findIndex(s=>s.value===a),n=b.findIndex(s=>s.value===e);return t===-1||n===-1||t>n?[]:b.slice(t,n+1).map(s=>s.value)}),h=D(()=>l.value==="unico"?!!u.value:!!(r.value&&d.value&&S.value.length));function i(a,e,t,n=3500){C.add({severity:a,summary:e,detail:t,life:n})}async function P(){let a=new URLSearchParams,e=[];if(l.value==="unico"){if(!u.value){i("error","Error","Seleccione un mes para generar el informe.");return}e=[w(u.value)]}else{if(!h.value){i("error","Error","Seleccione un rango válido de meses para generar el informe.");return}e=S.value}e.forEach(t=>a.append("meses[]",t));try{i("info","Generando informe...","",2e3);const t=await fetch(`/descargar-informe?${a.toString()}`),n=t.headers.get("content-type");if(n&&n.includes("application/json")){const f=await t.json();i("warn","Sin datos",f.message||"No se encontraron datos para el periodo seleccionado",5e3);return}if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);if(window.innerWidth<1024){const f=await t.blob();let y="informe.pdf";const V=t.headers.get("Content-Disposition")||t.headers.get("content-disposition");if(V){const k=V.match(/filename="?([^";]+)"?/i);k&&k[1]&&(y=k[1])}const E=window.URL.createObjectURL(f),p=document.createElement("a");p.href=E,p.download=y,document.body.appendChild(p),p.click(),p.remove(),window.URL.revokeObjectURL(E),i("success","Descarga iniciada",`El informe PDF (${y}) se está descargando.`,2500)}else window.open(`/descargar-informe?${a.toString()}&preview=1`,"_blank"),i("success","Informe abierto","El informe se abrió en una nueva ventana.",2500)}catch(t){console.error("Error al abrir el informe:",t),i("error","Error","Error al abrir el informe. Por favor, inténtelo de nuevo.",5e3)}}function j(){u.value=null,r.value=null,d.value=null,$.value=null}return(a,e)=>{const t=F("Toast"),n=F("DatePicker");return z(),W(H,null,[c(x(B),{title:"Informe de Tours"}),c(Y,null,{default:N(()=>[c(t),o("div",J,[o("div",q,[e[12]||(e[12]=o("div",{class:"flex items-center gap-2 sm:gap-3 mb-3"},[o("svg",{class:"w-7 h-7 sm:w-8 sm:h-8 text-blue-600",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 17v-2a4 4 0 014-4h6M9 17v2a4 4 0 004 4h6M9 17H5a2 2 0 01-2-2V7a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-4"})]),o("h1",{class:"text-lg sm:text-xl md:text-2xl font-extrabold text-gray-800 tracking-tight text-center"},"Informe de Cupos Vendidos Mensuales por Tour")],-1)),e[13]||(e[13]=o("p",{class:"text-gray-600 mb-3 sm:mb-5 text-center text-sm sm:text-base"}," Seleccione el rango de meses o un solo mes para generar el informe PDF. ",-1)),o("div",K,[o("label",Q,[I(o("input",{id:"radio-mes-unico",type:"radio","onUpdate:modelValue":e[0]||(e[0]=s=>l.value=s),value:"unico",class:"accent-blue-600"},null,512),[[U,l.value]]),e[5]||(e[5]=o("span",{class:"font-semibold text-gray-700 cursor-pointer select-none text-sm"},"Por mes",-1))]),o("label",X,[I(o("input",{id:"radio-activar-fechas",type:"radio","onUpdate:modelValue":e[1]||(e[1]=s=>l.value=s),value:"rango",class:"accent-blue-600"},null,512),[[U,l.value]]),e[6]||(e[6]=o("span",{class:"font-semibold text-gray-700 cursor-pointer select-none text-sm"},"Varios meses",-1))]),o("button",{onClick:j,class:"px-3 py-1 bg-gray-200 text-gray-700 rounded-lg shadow hover:bg-gray-300 transition font-semibold text-xs border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-200"},e[7]||(e[7]=[o("span",{class:"block sm:hidden"},"Limpiar",-1),o("span",{class:"hidden sm:block"},"Limpiar fechas",-1)]))]),o("div",Z,[e[8]||(e[8]=o("label",{for:"mes-unico-picker",class:"block mb-2 font-semibold text-gray-700"},"Mes único:",-1)),c(n,{id:"mes-unico-picker",modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value=s),view:"month",dateFormat:"MM yy",showIcon:"",class:"w-full text-xs sm:text-sm",placeholder:"Seleccione un mes",manualInput:!1,maxDate:x(g),minDate:x(L),disabled:l.value!=="unico"},null,8,["modelValue","maxDate","minDate","disabled"])]),o("div",ee,[o("div",oe,[e[9]||(e[9]=o("label",{for:"desde-picker",class:"block mb-2 font-semibold text-gray-700"},"Desde:",-1)),c(n,{id:"desde-picker",modelValue:r.value,"onUpdate:modelValue":e[3]||(e[3]=s=>r.value=s),view:"month",dateFormat:"MM yy",showIcon:"",class:"w-full text-xs sm:text-sm",placeholder:"Seleccione mes",manualInput:!1,maxDate:x(g),disabled:l.value!=="rango"},null,8,["modelValue","maxDate","disabled"])]),o("div",te,[e[10]||(e[10]=o("label",{for:"hasta-picker",class:"block mb-2 font-semibold text-gray-700"},"Hasta:",-1)),c(n,{id:"hasta-picker",modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=s=>d.value=s),view:"month",dateFormat:"MM yy",showIcon:"",class:"w-full text-xs sm:text-sm",placeholder:"Seleccione mes",manualInput:!1,maxDate:x(g),minDate:r.value,disabled:l.value!=="rango"},null,8,["modelValue","maxDate","minDate","disabled"])])]),o("div",se,[o("button",{onClick:P,class:O(["bg-gradient-to-r from-red-800 to-red-500 flex items-center gap-2 px-5 py-2 text-white rounded-lg shadow-lg hover:from-red-900 hover:to-red-600 transition font-semibold text-xs sm:text-base border border-red-800 focus:outline-none focus:ring-2 focus:ring-red-400",{"opacity-60 cursor-not-allowed":!h.value}]),disabled:!h.value},e[11]||(e[11]=[o("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),A(" Descargar PDF ")]),10,ae)])])])]),_:1})],64)}}};export{ce as default};
