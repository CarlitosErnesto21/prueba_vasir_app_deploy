import{N as A,r as f,E as ie,w as de,o as ue,k as v,c as y,d as x,p as r,$ as ve,a0 as me,x as o,e as a,F as L,l as B,q as n,t as i,j as k}from"./vendor-BOi6Gr0G.js";import{A as ce}from"./AuthenticatedLayout-ySbiGZ3w.js";import{z as pe}from"./ui-BibPgP1I.js";import"./logo-DN1bLr27.js";import"./index-Btbp3Gjs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const fe={class:"py-4 sm:py-6 px-4 sm:px-7 mt-6 sm:mt-10 mx-auto bg-red-50 shadow-md rounded-lg"},be={class:"bg-white p-4 rounded-lg shadow border border-gray-200 mb-6"},ge={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},ye={class:"flex gap-2"},xe={class:"text-center py-8"},he={class:"text-gray-500"},we={class:"font-medium"},Re={class:"text-sm text-gray-500"},_e={class:"font-medium"},Ae={class:"text-sm text-gray-500"},ke={class:"text-center"},De={class:"text-sm"},Ce={class:"font-medium"},Ne={class:"text-sm text-gray-500"},Te={class:"font-medium"},ze={class:"text-right font-medium text-green-600"},Ve={class:"flex gap-1 flex-wrap"},Ee=["onClick"],Fe=["onClick"],Ie=["onClick"],Le=["onClick"],Pe={class:"space-y-4"},Me={key:0,class:"bg-gray-50 p-4 rounded-lg"},$e={class:"flex justify-end gap-2"},Se=["disabled"],He={class:"space-y-4"},Ue={key:0,class:"bg-gray-50 p-4 rounded-lg"},qe={class:"flex justify-end gap-2"},Be=["disabled"],We={__name:"ReservaTours",setup(Oe){A.defaults.withCredentials=!0;const p=pe(),m=f([]),z=f(!1),u=f({tipo:"tours",busqueda:"",fechaDesde:null,fechaHasta:null}),D=f(!1),C=f(!1),d=f(null),R=f(""),h=f(null),_=f(""),V=f(0),N=[{label:"Pendientes",value:"PENDIENTE",severity:"warn"},{label:"Confirmadas",value:"CONFIRMADA",severity:"success"},{label:"Rechazadas",value:"RECHAZADA",severity:"danger"},{label:"Reprogramadas",value:"REPROGRAMADA",severity:"info"},{label:"Finalizadas",value:"FINALIZADA",severity:"secondary"}],O=ie(()=>{var e;const l=(e=N[V.value])==null?void 0:e.value;return m.value.filter(b=>b.estado===l)}),E=async()=>{z.value=!0;try{const l={tipo:u.value.tipo,busqueda:u.value.busqueda||void 0,fecha_inicio:u.value.fechaDesde||void 0,fecha_fin:u.value.fechaHasta||void 0},e=await A.get("/api/reservas",{params:l,withCredentials:!0});m.value=e.data.data||[]}catch{p.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las reservas",life:3e3}),m.value=[]}finally{z.value=!1}},Z=async l=>{try{await A.put(`/api/reservas/${l.id}/confirmar`);const e=m.value.findIndex(b=>b.id===l.id);e!==-1&&(m.value[e].estado="CONFIRMADA"),p.add({severity:"success",summary:"Éxito",detail:"Reserva confirmada correctamente",life:3e3})}catch{p.add({severity:"error",summary:"Error",detail:"No se pudo confirmar la reserva",life:3e3})}},G=l=>{d.value=l,R.value="",C.value=!0},j=async()=>{if(!R.value.trim()){p.add({severity:"warn",summary:"Advertencia",detail:"Debe ingresar un motivo para rechazar la reserva",life:3e3});return}try{await A.put(`/api/reservas/${d.value.id}/rechazar`,{motivo:R.value});const l=m.value.findIndex(e=>e.id===d.value.id);l!==-1&&(m.value[l].estado="RECHAZADA"),C.value=!1,p.add({severity:"success",summary:"Éxito",detail:"Reserva rechazada correctamente",life:3e3})}catch{p.add({severity:"error",summary:"Error",detail:"No se pudo rechazar la reserva",life:3e3})}},J=l=>{d.value=l,h.value=null,_.value="",D.value=!0},K=async()=>{if(!h.value||!_.value.trim()){p.add({severity:"warn",summary:"Advertencia",detail:"Debe ingresar una nueva fecha y motivo para reprogramar",life:3e3});return}try{await A.put(`/api/reservas/${d.value.id}/reprogramar`,{fecha_nueva:h.value,motivo:_.value});const l=m.value.findIndex(e=>e.id===d.value.id);l!==-1&&(m.value[l].estado="REPROGRAMADA",m.value[l].fecha_reserva=h.value),D.value=!1,p.add({severity:"success",summary:"Éxito",detail:"Reserva reprogramada correctamente",life:3e3})}catch{p.add({severity:"error",summary:"Error",detail:"No se pudo reprogramar la reserva",life:3e3})}},Q=async l=>{try{await A.put(`/api/reservas/${l.id}/confirmar`);const e=m.value.findIndex(b=>b.id===l.id);e!==-1&&(m.value[e].estado="FINALIZADA"),p.add({severity:"success",summary:"Éxito",detail:"Reserva finalizada correctamente",life:3e3})}catch{p.add({severity:"error",summary:"Error",detail:"No se pudo finalizar la reserva",life:3e3})}},T=l=>{switch(l.estado){case"PENDIENTE":return["confirmar","rechazar","reprogramar"];case"CONFIRMADA":return["rechazar","reprogramar","finalizar"];case"REPROGRAMADA":return["confirmar","rechazar"];case"RECHAZADA":return[];case"FINALIZADA":return[];default:return[]}},W=l=>{const e=N.find(b=>b.value===l);return(e==null?void 0:e.severity)||"secondary"},F=l=>l?new Date(l).toLocaleDateString("es-ES"):"N/A",X=()=>{u.value.fechaDesde=null,u.value.fechaHasta=null,E()};return de(()=>u.value,()=>{E()},{deep:!0}),ue(()=>{E()}),(l,e)=>{const b=v("Toast"),Y=v("Select"),ee=v("InputText"),I=v("DatePicker"),ae=v("Tab"),te=v("TabList"),w=v("Column"),le=v("Tag"),se=v("DataTable"),re=v("TabPanel"),oe=v("TabPanels"),ne=v("Tabs"),P=v("Textarea"),M=v("Dialog");return x(),y(L,null,[r(ve(me),{title:"Gestión de Reservas"}),r(ce,null,{default:o(()=>[r(b,{class:"z-[9999]"}),a("div",fe,[e[36]||(e[36]=a("div",{class:"flex flex-col lg:flex-row lg:justify-between lg:items-center mb-6 gap-4"},[a("h3",{class:"text-lg sm:text-2xl text-blue-600 font-bold"},"Gestión de Reservas")],-1)),a("div",be,[a("div",ge,[a("div",null,[e[12]||(e[12]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tipo de Reserva",-1)),r(Y,{modelValue:u.value.tipo,"onUpdate:modelValue":e[0]||(e[0]=s=>u.value.tipo=s),options:[{label:"Tours",value:"tours"},{label:"Hoteles",value:"hoteles"},{label:"Aerolíneas",value:"aerolineas"}],optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])]),a("div",null,[e[13]||(e[13]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Buscar",-1)),r(ee,{modelValue:u.value.busqueda,"onUpdate:modelValue":e[1]||(e[1]=s=>u.value.busqueda=s),placeholder:"Buscar por cliente, tour, hotel...",class:"w-full"},null,8,["modelValue"])]),a("div",null,[e[14]||(e[14]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Desde",-1)),r(I,{modelValue:u.value.fechaDesde,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value.fechaDesde=s),dateFormat:"dd/mm/yy",class:"w-full",showIcon:"",placeholder:"Fecha inicio"},null,8,["modelValue"])]),a("div",null,[e[16]||(e[16]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Hasta",-1)),a("div",ye,[r(I,{modelValue:u.value.fechaHasta,"onUpdate:modelValue":e[3]||(e[3]=s=>u.value.fechaHasta=s),dateFormat:"dd/mm/yy",class:"flex-1",showIcon:"",placeholder:"Fecha fin"},null,8,["modelValue"]),a("button",{class:"bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-md transition-colors",onClick:X,title:"Limpiar fechas"},e[15]||(e[15]=[a("i",{class:"pi pi-times"},null,-1)]))])])])]),r(ne,{value:V.value,"onUpdate:value":e[4]||(e[4]=s=>V.value=s),class:"bg-white rounded-lg shadow"},{default:o(()=>[r(te,null,{default:o(()=>[(x(),y(L,null,B(N,(s,g)=>r(ae,{key:s.value,value:g},{default:o(()=>[n(i(s.label)+" ("+i(m.value.filter(t=>t.estado===s.value).length)+") ",1)]),_:2},1032,["value"])),64))]),_:1}),r(oe,null,{default:o(()=>[(x(),y(L,null,B(N,(s,g)=>r(re,{key:s.value,value:g},{default:o(()=>[r(se,{value:O.value,loading:z.value,paginator:"",rows:10,rowsPerPageOptions:[5,10,20],paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} reservas",responsiveLayout:"scroll",class:"mt-4"},{empty:o(()=>[a("div",xe,[e[17]||(e[17]=a("i",{class:"pi pi-inbox text-4xl text-gray-400 mb-4"},null,-1)),a("p",he,"No hay reservas "+i(s.label.toLowerCase()),1)])]),loading:o(()=>e[18]||(e[18]=[a("div",{class:"text-center py-8"},[a("i",{class:"pi pi-spin pi-spinner text-2xl text-blue-500"}),a("p",{class:"text-gray-500 mt-2"},"Cargando reservas...")],-1)])),default:o(()=>[r(w,{field:"fecha_reserva",header:"Fecha",sortable:"",class:"min-w-[100px]"},{body:o(t=>[n(i(F(t.data.fecha_reserva)),1)]),_:1}),r(w,{field:"cliente.nombres",header:"Cliente",sortable:"",class:"min-w-[150px]"},{body:o(t=>{var c,$,S,H,U,q;return[a("div",null,[a("div",we,i((($=(c=t.data.cliente)==null?void 0:c.user)==null?void 0:$.name)||((S=t.data.cliente)==null?void 0:S.nombres)||"N/A"),1),a("div",Re,i(((U=(H=t.data.cliente)==null?void 0:H.user)==null?void 0:U.email)||((q=t.data.cliente)==null?void 0:q.correo)||"N/A"),1)])]}),_:1}),r(w,{field:"entidad_nombre",header:"Servicio",sortable:"",class:"min-w-[200px]"},{body:o(t=>[a("div",null,[a("div",_e,i(t.data.entidad_nombre||"N/A"),1),a("div",Ae,i(t.data.tipo||"N/A"),1)])]),_:1}),r(w,{header:"Personas",class:"min-w-[100px]"},{body:o(t=>[a("div",ke,[a("div",De,[a("span",Ce,i(t.data.mayores_edad||0),1),e[19]||(e[19]=n(" adultos "))]),a("div",Ne,[a("span",Te,i(t.data.menores_edad||0),1),e[20]||(e[20]=n(" niños "))])])]),_:1}),r(w,{field:"total",header:"Total",sortable:"",class:"min-w-[100px]"},{body:o(t=>[a("div",ze," $"+i(Number(t.data.total||0).toFixed(2)),1)]),_:1}),r(w,{field:"estado",header:"Estado",class:"min-w-[120px]"},{body:o(t=>[r(le,{value:t.data.estado,severity:W(t.data.estado),class:"text-sm"},null,8,["value","severity"])]),_:2},1024),r(w,{header:"Acciones",class:"min-w-[200px]"},{body:o(t=>[a("div",Ve,[T(t.data).includes("confirmar")?(x(),y("button",{key:0,class:"bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm transition-colors",onClick:c=>Z(t.data),title:"Confirmar reserva"},e[21]||(e[21]=[a("i",{class:"pi pi-check mr-1"},null,-1),n(" Confirmar ")]),8,Ee)):k("",!0),T(t.data).includes("rechazar")?(x(),y("button",{key:1,class:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors",onClick:c=>G(t.data),title:"Rechazar reserva"},e[22]||(e[22]=[a("i",{class:"pi pi-times mr-1"},null,-1),n(" Rechazar ")]),8,Fe)):k("",!0),T(t.data).includes("reprogramar")?(x(),y("button",{key:2,class:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition-colors",onClick:c=>J(t.data),title:"Reprogramar reserva"},e[23]||(e[23]=[a("i",{class:"pi pi-calendar mr-1"},null,-1),n(" Reprogramar ")]),8,Ie)):k("",!0),T(t.data).includes("finalizar")?(x(),y("button",{key:3,class:"bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded text-sm transition-colors",onClick:c=>Q(t.data),title:"Finalizar reserva"},e[24]||(e[24]=[a("i",{class:"pi pi-check-circle mr-1"},null,-1),n(" Finalizar ")]),8,Le)):k("",!0)])]),_:1})]),_:2},1032,["value","loading"])]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["value"]),r(M,{visible:C.value,"onUpdate:visible":e[7]||(e[7]=s=>C.value=s),modal:"",header:"Rechazar Reserva",style:{width:"500px"}},{footer:o(()=>[a("div",$e,[a("button",{class:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded transition-colors",onClick:e[6]||(e[6]=s=>C.value=!1)}," Cancelar "),a("button",{class:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded transition-colors",onClick:j,disabled:!R.value.trim()}," Rechazar Reserva ",8,Se)])]),default:o(()=>{var s,g,t;return[a("div",Pe,[d.value?(x(),y("div",Me,[e[28]||(e[28]=a("h4",{class:"font-medium text-gray-800 mb-2"},"Detalles de la Reserva",-1)),a("p",null,[e[25]||(e[25]=a("strong",null,"Cliente:",-1)),n(" "+i(((g=(s=d.value.cliente)==null?void 0:s.user)==null?void 0:g.name)||((t=d.value.cliente)==null?void 0:t.nombres)||"N/A"),1)]),a("p",null,[e[26]||(e[26]=a("strong",null,"Servicio:",-1)),n(" "+i(d.value.entidad_nombre),1)]),a("p",null,[e[27]||(e[27]=a("strong",null,"Fecha:",-1)),n(" "+i(F(d.value.fecha_reserva)),1)])])):k("",!0),a("div",null,[e[29]||(e[29]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[n(" Motivo del rechazo "),a("span",{class:"text-red-500"},"*")],-1)),r(P,{modelValue:R.value,"onUpdate:modelValue":e[5]||(e[5]=c=>R.value=c),placeholder:"Ingrese el motivo por el cual se rechaza esta reserva...",rows:"3",class:"w-full"},null,8,["modelValue"])])])]}),_:1},8,["visible"]),r(M,{visible:D.value,"onUpdate:visible":e[11]||(e[11]=s=>D.value=s),modal:"",header:"Reprogramar Reserva",style:{width:"500px"}},{footer:o(()=>[a("div",qe,[a("button",{class:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded transition-colors",onClick:e[10]||(e[10]=s=>D.value=!1)}," Cancelar "),a("button",{class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors",onClick:K,disabled:!h.value||!_.value.trim()}," Reprogramar ",8,Be)])]),default:o(()=>{var s,g,t;return[a("div",He,[d.value?(x(),y("div",Ue,[e[33]||(e[33]=a("h4",{class:"font-medium text-gray-800 mb-2"},"Detalles de la Reserva",-1)),a("p",null,[e[30]||(e[30]=a("strong",null,"Cliente:",-1)),n(" "+i(((g=(s=d.value.cliente)==null?void 0:s.user)==null?void 0:g.name)||((t=d.value.cliente)==null?void 0:t.nombres)||"N/A"),1)]),a("p",null,[e[31]||(e[31]=a("strong",null,"Servicio:",-1)),n(" "+i(d.value.entidad_nombre),1)]),a("p",null,[e[32]||(e[32]=a("strong",null,"Fecha actual:",-1)),n(" "+i(F(d.value.fecha_reserva)),1)])])):k("",!0),a("div",null,[e[34]||(e[34]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[n(" Nueva fecha "),a("span",{class:"text-red-500"},"*")],-1)),r(I,{modelValue:h.value,"onUpdate:modelValue":e[8]||(e[8]=c=>h.value=c),dateFormat:"dd/mm/yy",class:"w-full",showIcon:"",placeholder:"Seleccione la nueva fecha",minDate:new Date},null,8,["modelValue","minDate"])]),a("div",null,[e[35]||(e[35]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[n(" Motivo de la reprogramación "),a("span",{class:"text-red-500"},"*")],-1)),r(P,{modelValue:_.value,"onUpdate:modelValue":e[9]||(e[9]=c=>_.value=c),placeholder:"Ingrese el motivo de la reprogramación...",rows:"3",class:"w-full"},null,8,["modelValue"])])])]}),_:1},8,["visible"])])]),_:1})],64)}}};export{We as default};
