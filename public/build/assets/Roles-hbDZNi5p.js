import{r as v,E as R,w as Fe,k as Ge,h as He,d as l,x as Ke,p as c,e,c as a,j as C,q as y,$ as r,t as d,v as P,a5 as L,a7 as de,F as E,l as U,y as I,a6 as Oe,I as We,a8 as Je,a9 as Qe,a3 as Xe,N as B}from"./vendor-BOi6Gr0G.js";import{A as Ye}from"./AuthenticatedLayout-ySbiGZ3w.js";import{z as Ze,A as p}from"./ui-BibPgP1I.js";import{v as ue,x as es,y as he,m as _e,n as ss,e as Q,z as we,g as ce,a as se,A as ke}from"./index-Btbp3Gjs.js";import"./logo-DN1bLr27.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ts={class:"container mx-auto px-4 py-8"},os={class:"bg-white rounded-lg shadow-lg overflow-hidden"},ls={class:"bg-gradient-to-r from-red-600 to-red-700 px-6 py-4"},as={class:"flex justify-between items-center"},rs={class:"text-2xl font-bold text-white flex items-center"},ns={class:"p-6"},is={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"},ds={class:"bg-red-50 rounded-lg p-4"},us={class:"flex items-center"},cs={class:"ml-4"},ms={class:"text-2xl font-bold text-red-900"},vs={class:"bg-blue-50 rounded-lg p-4"},ps={class:"flex items-center"},gs={class:"ml-4"},xs={class:"text-2xl font-bold text-blue-900"},fs={class:"bg-green-50 rounded-lg p-4"},bs={class:"flex items-center"},ys={class:"ml-4"},hs={class:"text-2xl font-bold text-green-900"},_s={class:"mb-6 flex flex-wrap gap-4"},ws={class:"flex-1 min-w-64"},ks={class:"relative"},Cs={class:"overflow-x-auto"},Ps={class:"min-w-full bg-white border border-gray-200 rounded-lg"},Es={class:"divide-y divide-gray-200"},Us={class:"px-6 py-4 whitespace-nowrap"},Ms={class:"flex items-center"},As={class:"flex-shrink-0 h-10 w-10"},js=["src","alt"],$s={class:"ml-4"},Rs={class:"text-sm font-medium text-gray-900"},zs={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ns={class:"px-6 py-4 whitespace-nowrap"},Vs={class:"flex flex-wrap gap-1"},Ds={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ts={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ls={class:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2"},Is=["onClick"],Bs=["onClick"],Ss={key:0,class:"mt-6 flex items-center justify-between"},qs={class:"flex items-center text-sm text-gray-500"},Fs={class:"flex items-center space-x-2"},Gs={class:"flex items-center space-x-2"},Hs={class:"relative"},Ks={class:"flex items-center space-x-1"},Os=["disabled"],Ws=["disabled"],Js=["onClick"],Qs={key:1,class:"px-2 text-gray-500"},Xs=["disabled"],Ys=["disabled"],Zs={key:1,class:"text-center py-8"},et={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},st={class:"bg-white rounded-lg p-6 w-[600px] max-w-full mx-4 max-h-[90vh] overflow-y-auto"},tt={class:"text-lg font-semibold mb-4 flex items-center"},ot={class:"mb-6"},lt={class:"text-gray-600 mb-1"},at={class:"text-gray-600 mb-3"},rt={class:"mb-4 p-4 bg-gray-50 rounded-lg"},nt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},it={class:"mb-4 p-3 bg-blue-50 rounded-lg"},dt={class:"flex flex-wrap gap-1"},ut={key:0,class:"px-2 py-1 text-xs bg-gray-200 text-gray-600 rounded-full"},ct={class:"space-y-2 mb-4"},mt=["id","value"],vt=["for"],pt={class:"border-t pt-4"},gt={key:0,class:"mb-4"},xt={class:"text-sm font-medium text-green-700 mb-2 flex items-center"},ft={class:"space-y-2 max-h-32 overflow-y-auto"},bt={class:"flex items-center"},yt={class:"text-sm text-green-800 font-medium"},ht=["onClick","disabled","title"],_t={key:0,class:"mt-2 flex items-center text-orange-600 text-xs"},wt={key:1},kt={class:"text-sm font-medium text-blue-700 mb-2 flex items-center"},Ct={class:"space-y-2 max-h-32 overflow-y-auto"},Pt={class:"text-sm text-gray-700"},Et=["onClick"],Ut={key:2,class:"text-center py-3 text-gray-500 text-sm"},Mt={class:"flex justify-end space-x-3"},At=["disabled"],jt={key:0},$t={key:1},Rt={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},zt={class:"bg-white rounded-lg p-6 w-96 max-w-full mx-4"},Nt={class:"text-lg font-semibold mb-4 flex items-center"},Vt={class:"mb-4"},Dt={class:"text-gray-600 mb-2"},Tt={class:"text-gray-600 mb-4"},Lt={key:0,class:"text-center py-4"},It={key:1,class:"space-y-2 max-h-48 overflow-y-auto"},Bt={class:"text-sm text-gray-700"},St={key:2,class:"text-center py-4"},qt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ft={class:"bg-white rounded-lg p-6 w-[700px] max-w-full mx-4 max-h-[90vh] overflow-y-auto"},Gt={class:"relative"},Ht=["type"],Kt={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ot={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Wt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Jt={class:"border-t pt-4"},Qt={class:"mb-3"},Xt={class:"text-md font-semibold text-gray-800 mb-2 flex items-center"},Yt={class:"mb-4"},Zt={class:"max-h-60 overflow-y-auto border rounded p-3 bg-gray-50"},eo={key:0,class:"space-y-2"},so=["id","value","disabled"],to=["for"],oo={key:1,class:"text-center py-3 text-gray-500"},lo={class:"mt-3 flex items-center justify-between"},ao={class:"text-sm"},ro={class:"font-medium text-gray-700"},no={key:0,class:"text-red-600 ml-2"},io={key:1,class:"text-green-600 ml-2"},uo={class:"flex gap-2"},co=["disabled"],mo={class:"flex justify-end space-x-3 pt-4"},vo=["disabled"],po={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},go={class:"bg-white rounded-lg p-6 w-[600px] max-w-full mx-4 max-h-[90vh] overflow-y-auto"},xo={class:"text-lg font-semibold mb-4 flex items-center"},fo={class:"mb-4"},bo={class:"text-gray-600 mb-2"},yo={class:"text-gray-600 mb-4"},ho={class:"space-y-6"},_o={class:"text-md font-semibold text-gray-800 mb-3 flex items-center"},wo={key:0,class:"space-y-2 max-h-40 overflow-y-auto border rounded p-3"},ko={class:"flex items-center"},Co={class:"text-sm text-gray-700"},Po=["onClick","disabled"],Eo={key:1,class:"text-center py-4 text-gray-500 border rounded"},Uo={key:2,class:"mt-2 text-xs text-orange-600 flex items-center"},Mo={class:"text-md font-semibold text-gray-800 mb-3 flex items-center"},Ao={key:0,class:"space-y-2 max-h-40 overflow-y-auto border rounded p-3"},jo={class:"text-sm text-gray-700"},$o=["onClick","disabled"],Ro={key:1,class:"text-center py-4 text-gray-500 border rounded"},zo={class:"flex justify-end space-x-3 mt-6 pt-4 border-t"},No=["disabled"],Vo={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Do={class:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4"},To={class:"p-6"},Lo={class:"flex items-center mb-4"},Io={class:"flex justify-end space-x-3"},Ko={__name:"Roles",props:{users:Array,roles:Array,permissions:Array},setup(Ce){const te=Ze(),oe=Ce,X=v(!1),z=v(oe.users||[]);v(oe.roles||[]);const S=v(oe.permissions||[]),q=v(""),G=v(""),le=v(!1),ae=v(!1),me=v(!1),re=v(!1),Y=v(!1),m=v(null),i=v([]),A=v([]),x=v(null),j=v(null),Z=v(""),M=v([]),f=v(!1),ve=v(!1),_=v(1),D=v(5);v([]);const T=v(""),n=v({name:"",email:"",password:"",role:"empleado",cargo:"",telefono:"",selectedPermissions:[]}),F=R(()=>{let o=z.value;return q.value&&(o=o.filter(s=>s.name.toLowerCase().includes(q.value.toLowerCase())||s.email.toLowerCase().includes(q.value.toLowerCase()))),G.value&&(o=o.filter(s=>s.roles.includes(G.value))),o}),H=R(()=>Math.ceil(F.value.length/D.value)),Pe=R(()=>{const o=(_.value-1)*D.value,s=o+D.value;return F.value.slice(o,s)}),ne=R(()=>{const o=(_.value-1)*D.value+1,s=Math.min(_.value*D.value,F.value.length);return{start:o,end:s,total:F.value.length}}),Ee=R(()=>["admin","empleado"]),Ue=R(()=>{if(!m.value||!m.value.roles||m.value.roles.length===0)return"Editar datos del usuario";const o=m.value.roles[0];return o==="admin"?"Editar datos del administrador":o==="empleado"?"Editar datos del empleado":"Editar datos del usuario"}),pe=R(()=>{const o=T.value!==Z.value,s=x.value&&j.value&&(x.value.cargo!==j.value.cargo||x.value.telefono!==j.value.telefono),u=A.value.length>0&&(i.value.length!==A.value.length||!i.value.every(g=>A.value.includes(g))||!A.value.every(g=>i.value.includes(g)));return o||s||u}),Me=R(()=>"Actualizar"),Ae=R(()=>{const o=[],s=H.value,u=_.value;if(s<=7)for(let g=1;g<=s;g++)o.push(g);else u<=4?o.push(1,2,3,4,5,"...",s):u>=s-3?o.push(1,"...",s-4,s-3,s-2,s-1,s):o.push(1,"...",u-1,u,u+1,"...",s);return o}),ge=o=>z.value.filter(s=>s.roles.includes(o)).length,K=o=>{o>=1&&o<=H.value&&(_.value=o)};Fe([q,G],()=>{_.value=1});const je=async o=>{m.value={...o},T.value=o.roles[0]||"",Z.value=o.roles[0]||"",i.value=[],A.value=[],x.value={cargo:"",telefono:""},j.value={cargo:"",telefono:""},f.value=!0,le.value=!0;try{await Re(o),await ze(o)}catch(s){console.error("Error loading user data:",s),b("Error al cargar los datos del usuario")}finally{f.value=!1}},$e=()=>{pe.value?Y.value=!0:ie()},ie=()=>{le.value=!1,Y.value=!1,m.value=null,T.value="",Z.value="",i.value=[],A.value=[],x.value=null,j.value=null,M.value=[]},Re=async o=>{try{const s=await B.get(`/roles/users/${o.id}/permissions`);s.data.success&&(i.value=[...s.data.permissions],A.value=[...s.data.permissions],M.value=S.value.filter(u=>!i.value.includes(u.name)))}catch(s){throw console.error("Error fetching user permissions:",s),s}},ze=async o=>{try{const s=await B.get(`/roles/users/${o.id}/employee`);if(s.data.success&&s.data.employee){const u={cargo:s.data.employee.cargo||"",telefono:s.data.employee.telefono||""};x.value={...u},j.value={...u}}else{const u={cargo:"",telefono:""};x.value={...u},j.value={...u}}}catch(s){console.error("Error fetching employee data:",s);const u={cargo:"",telefono:""};x.value={...u},j.value={...u}}},xe=async o=>{!m.value||ve.value||i.value.includes(o)||(i.value.push(o),M.value=S.value.filter(s=>!i.value.includes(s.name)))},fe=async o=>{if(!m.value||ve.value)return;if(i.value.length===1){b("No se puede eliminar el último permiso. El usuario debe tener al menos uno.");return}const s=i.value.indexOf(o);s>-1&&(i.value.splice(s,1),M.value=S.value.filter(u=>!i.value.includes(u.name)))},Ne=async o=>{m.value=o,f.value=!0;try{const s=await B.get(`/roles/users/${o.id}/permissions`);s.data.success&&(i.value=s.data.permissions||[],ae.value=!0)}catch(s){console.error("Error fetching permissions:",s),b("Error al obtener los permisos del usuario")}finally{f.value=!1}},Ve=()=>{ae.value=!1,m.value=null,i.value=[]},De=()=>{me.value=!1,m.value=null,i.value=[],M.value=[]},Te=()=>{re.value=!0,n.value.selectedPermissions=[]},Le=()=>{n.value.selectedPermissions=[]},Ie=()=>{n.value.selectedPermissions=S.value.map(o=>o.name)},Be=async()=>{var g,$,O,W,J;if(!m.value){b("Error: No hay usuario seleccionado");return}const o=T.value!==Z.value,s=x.value&&j.value&&(x.value.cargo!==j.value.cargo||x.value.telefono!==j.value.telefono),u=A.value.length>0&&(i.value.length!==A.value.length||!i.value.every(h=>A.value.includes(h))||!A.value.every(h=>i.value.includes(h)));if(!o&&!s&&!u){b("No hay cambios para guardar");return}f.value=!0;try{let h=[],w=[];if(s){if(!((g=x.value)!=null&&g.cargo)||!(($=x.value)!=null&&$.telefono)){b("Por favor complete todos los campos del empleado"),f.value=!1;return}h.push(B.put(`/roles/users/${m.value.id}/employee`,{cargo:x.value.cargo,telefono:x.value.telefono}).then(()=>{w.push("Datos del empleado actualizados")}))}o&&h.push(B.post(`/roles/users/${m.value.id}/update-roles`,{roles:[T.value]}).then(N=>{if(N.data.success){const V=z.value.findIndex(t=>t.id===m.value.id);V!==-1&&(z.value[V]=N.data.user),w.push("Rol actualizado")}})),u&&h.push(B.put(`/roles/users/${m.value.id}/sync-permissions`,{permissions:i.value}).then(N=>{if(N.data.success){const V=z.value.findIndex(t=>t.id===m.value.id);V!==-1&&(z.value[V]=N.data.user),w.push("Permisos actualizados")}})),await Promise.all(h),ye(w.join(" y ")+" correctamente"),ie()}catch(h){if(console.error("Error saving changes:",h),((O=h.response)==null?void 0:O.status)===422){const w=h.response.data.errors;w.cargo?b("Error en el campo cargo: "+w.cargo[0]):w.telefono?b("Error en el campo teléfono: "+w.telefono[0]):w.roles?b("Error en el rol seleccionado"):w.permissions?b("Error en los permisos seleccionados"):b("Por favor revise los datos ingresados")}else b(((J=(W=h.response)==null?void 0:W.data)==null?void 0:J.message)||"Error al guardar los cambios")}finally{f.value=!1}},Se=async()=>{var o,s,u;if(!n.value.name||!n.value.email||!n.value.password||!n.value.cargo||!n.value.telefono){b("Por favor complete todos los campos");return}if(n.value.selectedPermissions.length===0){b("Debe seleccionar al menos un permiso para el usuario");return}f.value=!0;try{const g=await B.post("/roles/create-user",{name:n.value.name,email:n.value.email,password:n.value.password,role:n.value.role,cargo:n.value.cargo,telefono:n.value.telefono,permissions:n.value.selectedPermissions});if(g.data.success){let $=g.data.user;z.value.push($),be(),ye(g.data.message||`Usuario ${n.value.name} creado correctamente`)}}catch(g){if(console.error("Error creating user:",g),((o=g.response)==null?void 0:o.status)===422){const $=g.response.data.errors;$.email?b("Este email ya está registrado"):$.permissions?b("Error en los permisos seleccionados"):b("Por favor revise los datos ingresados")}else b(((u=(s=g.response)==null?void 0:s.data)==null?void 0:u.message)||"Error al crear el usuario")}finally{f.value=!1}},be=()=>{re.value=!1,n.value={name:"",email:"",password:"",role:"empleado",cargo:"",telefono:"",selectedPermissions:[]}},ee=o=>({admin:"bg-red-100 text-red-800",empleado:"bg-blue-100 text-blue-800"})[o]||"bg-gray-100 text-gray-800",ye=o=>{te.add({severity:"success",summary:"Éxito",detail:o,life:4e3})},b=o=>{te.add({severity:"error",summary:"Error",detail:o,life:5e3})},qe=()=>{te.add({severity:"info",summary:"Actualizando",detail:"Recargando datos de usuarios y roles...",life:2e3}),Xe.reload({only:["users","roles"]})};return(o,s)=>{const u=Ge("Toast");return l(),He(Ye,null,{default:Ke(()=>{var g,$,O,W,J,h,w,N,V;return[c(u),e("div",ts,[e("div",os,[e("div",ls,[e("div",as,[e("div",null,[e("h1",rs,[c(r(p),{icon:r(ue),class:"mr-3"},null,8,["icon"]),s[20]||(s[20]=y(" Gestión de Usuarios Internos "))]),s[21]||(s[21]=e("p",{class:"text-red-100 mt-2"},"Gestione empleados, administradores y sus permisos",-1))]),e("button",{onClick:Te,class:"bg-white text-red-600 px-4 py-2 rounded-lg font-semibold hover:bg-red-50 transition-colors duration-200 flex items-center"},[c(r(p),{icon:r(es),class:"mr-2"},null,8,["icon"]),s[22]||(s[22]=y(" Nuevo Usuario "))])])]),e("div",ns,[e("div",is,[e("div",ds,[e("div",us,[c(r(p),{icon:r(ue),class:"h-8 w-8 text-red-600"},null,8,["icon"]),e("div",cs,[s[23]||(s[23]=e("p",{class:"text-sm font-medium text-red-600"},"Total Usuarios",-1)),e("p",ms,d(z.value.length),1)])])]),e("div",vs,[e("div",ps,[c(r(p),{icon:r(he),class:"h-8 w-8 text-blue-600"},null,8,["icon"]),e("div",gs,[s[24]||(s[24]=e("p",{class:"text-sm font-medium text-blue-600"},"Administradores",-1)),e("p",xs,d(ge("admin")),1)])])]),e("div",fs,[e("div",bs,[c(r(p),{icon:r(ue),class:"h-8 w-8 text-green-600"},null,8,["icon"]),e("div",ys,[s[25]||(s[25]=e("p",{class:"text-sm font-medium text-green-600"},"Empleados",-1)),e("p",hs,d(ge("empleado")),1)])])])]),e("div",_s,[e("div",ws,[P(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>q.value=t),type:"text",placeholder:"Buscar por nombre o email...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"},null,512),[[L,q.value]])]),e("div",ks,[P(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>G.value=t),class:"px-4 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent bg-white cursor-pointer w-full",style:{appearance:"none","-webkit-appearance":"none","-moz-appearance":"none"}},s[26]||(s[26]=[e("option",{value:""},"Todos los roles",-1),e("option",{value:"admin"},"Administrador",-1),e("option",{value:"empleado"},"Empleado",-1)]),512),[[de,G.value]]),s[27]||(s[27]=e("div",{class:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none"},[e("svg",{class:"w-5 h-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})])],-1))]),e("button",{onClick:qe,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"}," Actualizar ")]),e("div",Cs,[e("table",Ps,[s[28]||(s[28]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Usuario "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Email "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Roles "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fecha Registro "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Última Actualización "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Acciones ")])],-1)),e("tbody",Es,[(l(!0),a(E,null,U(Pe.value,t=>(l(),a("tr",{key:t.id,class:"hover:bg-gray-50"},[e("td",Us,[e("div",Ms,[e("div",As,[e("img",{src:`https://ui-avatars.com/api/?name=${encodeURIComponent(t.name)}&background=ed1c24&color=fff&size=40`,class:"h-10 w-10 rounded-full",alt:t.name},null,8,js)]),e("div",$s,[e("div",Rs,d(t.name),1)])])]),e("td",zs,d(t.email),1),e("td",Ns,[e("div",Vs,[(l(!0),a(E,null,U(t.roles,k=>(l(),a("span",{key:k,class:I([ee(k),"px-2 py-1 text-xs font-semibold rounded-full"])},d(k),3))),128))])]),e("td",Ds,d(t.created_at),1),e("td",Ts,d(t.updated_at),1),e("td",Ls,[e("button",{onClick:k=>je(t),class:"text-orange-600 hover:text-orange-900 transition-colors",title:"Editar Roles y Permisos"},[c(r(p),{icon:r(_e),class:"h-5 w-5"},null,8,["icon"])],8,Is),e("button",{onClick:k=>Ne(t),class:"text-blue-600 hover:text-blue-900 transition-colors",title:"Ver Permisos"},[c(r(p),{icon:r(ss),class:"h-5 w-5"},null,8,["icon"])],8,Bs)])]))),128))])])]),F.value.length>0?(l(),a("div",Ss,[e("div",qs,[e("span",null,"Mostrando "+d(ne.value.start)+" - "+d(ne.value.end)+" de "+d(ne.value.total)+" usuarios",1)]),e("div",Fs,[e("div",Gs,[s[31]||(s[31]=e("span",{class:"text-sm text-gray-500"},"Mostrar:",-1)),e("div",Hs,[P(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>D.value=t),onChange:s[3]||(s[3]=t=>_.value=1),class:"appearance-none border border-gray-300 rounded px-2 py-1 pr-6 text-sm bg-white focus:outline-none focus:ring-1 focus:ring-red-500 focus:border-red-500"},s[29]||(s[29]=[e("option",{value:5},"5",-1),e("option",{value:10},"10",-1),e("option",{value:15},"15",-1),e("option",{value:20},"20",-1)]),544),[[de,D.value]]),s[30]||(s[30]=e("div",{class:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none"},[e("svg",{class:"w-3 h-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])],-1))])]),e("div",Ks,[e("button",{onClick:s[4]||(s[4]=t=>K(1)),disabled:_.value===1,class:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," ⟪ ",8,Os),e("button",{onClick:s[5]||(s[5]=t=>K(_.value-1)),disabled:_.value===1,class:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," ⟨ ",8,Ws),(l(!0),a(E,null,U(Ae.value,t=>(l(),a("span",{key:t},[t!=="..."?(l(),a("button",{key:0,onClick:k=>K(t),class:I([t===_.value?"bg-red-600 text-white":"text-gray-700 hover:bg-gray-50","px-3 py-1 text-sm border border-gray-300 rounded"])},d(t),11,Js)):(l(),a("span",Qs,"..."))]))),128)),e("button",{onClick:s[6]||(s[6]=t=>K(_.value+1)),disabled:_.value===H.value,class:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," ⟩ ",8,Xs),e("button",{onClick:s[7]||(s[7]=t=>K(H.value)),disabled:_.value===H.value,class:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," ⟫ ",8,Ys)])])])):C("",!0),F.value.length===0?(l(),a("div",Zs,s[32]||(s[32]=[e("p",{class:"text-gray-500"},"No se encontraron usuarios con los filtros aplicados.",-1)]))):C("",!0)])]),le.value?(l(),a("div",et,[e("div",st,[e("h3",tt,[c(r(p),{icon:r(_e),class:"mr-2 text-red-600"},null,8,["icon"]),y(" "+d(Ue.value),1)]),e("div",ot,[e("p",lt,[s[33]||(s[33]=y("Usuario: ")),e("strong",null,d((g=m.value)==null?void 0:g.name),1)]),e("p",at,[s[34]||(s[34]=y("Email: ")),e("strong",null,d(($=m.value)==null?void 0:$.email),1)]),e("div",rt,[s[37]||(s[37]=e("h4",{class:"text-sm font-medium text-gray-800 mb-3"},"Información del Empleado",-1)),e("div",nt,[e("div",null,[s[35]||(s[35]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cargo",-1)),P(e("input",{"onUpdate:modelValue":s[8]||(s[8]=t=>x.value.cargo=t),type:"text",maxlength:"25",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-sm",placeholder:"Ej: Ejecutivo de ventas, Administrador, etc."},null,512),[[L,x.value.cargo]])]),e("div",null,[s[36]||(s[36]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Teléfono",-1)),P(e("input",{"onUpdate:modelValue":s[9]||(s[9]=t=>x.value.telefono=t),type:"tel",maxlength:"8",pattern:"[0-9]{8}",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-sm",placeholder:"12345678"},null,512),[[L,x.value.telefono]])])])]),e("div",it,[s[38]||(s[38]=e("p",{class:"text-sm font-medium text-blue-800 mb-2"},"Rol Actual:",-1)),e("div",dt,[(l(!0),a(E,null,U((O=m.value)==null?void 0:O.roles,t=>(l(),a("span",{key:t,class:I([ee(t),"px-2 py-1 text-xs font-semibold rounded-full"])},d(t),3))),128)),(J=(W=m.value)==null?void 0:W.roles)!=null&&J.length?C("",!0):(l(),a("span",ut," Sin rol asignado "))])]),s[41]||(s[41]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Cambiar Rol:",-1)),e("div",ct,[(l(!0),a(E,null,U(Ee.value,t=>(l(),a("div",{key:t,class:"flex items-center"},[P(e("input",{id:`role-${t}`,type:"radio",value:t,"onUpdate:modelValue":s[10]||(s[10]=k=>T.value=k),name:"userRole",class:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300"},null,8,mt),[[Oe,T.value]]),e("label",{for:`role-${t}`,class:"ml-2 text-sm text-gray-700 capitalize"},d(t),9,vt)]))),128))]),e("div",pt,[s[40]||(s[40]=e("p",{class:"text-sm text-gray-600 mb-3"},"Los roles son organizacionales. Los permisos se gestionan manualmente.",-1)),i.value.length>0?(l(),a("div",gt,[e("h4",xt,[c(r(p),{icon:r(Q),class:"mr-2"},null,8,["icon"]),y(" Permisos Asignados ("+d(i.value.length)+") ",1)]),e("div",ft,[(l(!0),a(E,null,U(i.value,t=>(l(),a("div",{key:t,class:"flex items-center justify-between p-2 bg-green-50 border border-green-200 rounded"},[e("div",bt,[c(r(p),{icon:r(Q),class:"text-green-600 mr-2"},null,8,["icon"]),e("span",yt,d(t),1)]),e("button",{onClick:k=>fe(t),class:"text-red-600 hover:text-red-800 transition-colors",disabled:i.value.length===1,title:i.value.length===1?"No se puede eliminar el último permiso":"Eliminar permiso"},[c(r(p),{icon:r(we)},null,8,["icon"])],8,ht)]))),128))]),i.value.length===1?(l(),a("div",_t,[c(r(p),{icon:r(ce),class:"mr-1"},null,8,["icon"]),s[39]||(s[39]=y(" No se puede eliminar el último permiso. El usuario debe tener al menos uno. "))])):C("",!0)])):C("",!0),M.value.length>0?(l(),a("div",wt,[e("h4",kt,[c(r(p),{icon:r(se),class:"mr-2"},null,8,["icon"]),y(" Asignar Nuevos Permisos ("+d(M.value.length)+") ",1)]),e("div",Ct,[(l(!0),a(E,null,U(M.value,t=>(l(),a("div",{key:t.name,class:"flex items-center justify-between p-2 bg-white border border-gray-200 rounded hover:bg-blue-50 transition-colors"},[e("span",Pt,d(t.name),1),e("button",{onClick:k=>xe(t.name),class:"text-blue-600 hover:text-blue-800 transition-colors",title:"Asignar permiso"},[c(r(p),{icon:r(se)},null,8,["icon"])],8,Et)]))),128))])])):C("",!0),M.value.length===0&&i.value.length>0?(l(),a("div",Ut," ✅ El usuario tiene todos los permisos disponibles ")):C("",!0)])]),e("div",Mt,[e("button",{onClick:$e,class:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"}," Cerrar "),e("button",{onClick:Be,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:f.value||!pe.value},[f.value?(l(),a("span",jt,"Guardando...")):(l(),a("span",$t,d(Me.value),1))],8,At)])])])):C("",!0),ae.value?(l(),a("div",Rt,[e("div",zt,[e("h3",Nt,[c(r(p),{icon:r(he),class:"mr-2 text-blue-600"},null,8,["icon"]),s[42]||(s[42]=y(" Permisos del Usuario "))]),e("div",Vt,[e("p",Dt,[s[43]||(s[43]=y("Usuario: ")),e("strong",null,d((h=m.value)==null?void 0:h.name),1)]),e("p",Tt,[s[44]||(s[44]=y("Roles: ")),(l(!0),a(E,null,U((w=m.value)==null?void 0:w.roles,t=>(l(),a("span",{key:t,class:I([ee(t),"px-2 py-1 text-xs font-semibold rounded-full ml-1"])},d(t),3))),128))]),s[47]||(s[47]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Permisos:",-1)),f.value?(l(),a("div",Lt,s[45]||(s[45]=[e("p",{class:"text-gray-500"},"Cargando permisos...",-1)]))):i.value.length>0?(l(),a("div",It,[(l(!0),a(E,null,U(i.value,t=>(l(),a("div",{key:t,class:"flex items-center p-2 bg-gray-50 rounded"},[c(r(p),{icon:r(Q),class:"text-green-600 mr-2"},null,8,["icon"]),e("span",Bt,d(t),1)]))),128))])):(l(),a("div",St,s[46]||(s[46]=[e("p",{class:"text-gray-500"},"No se encontraron permisos para este usuario.",-1)])))]),e("div",{class:"flex justify-end"},[e("button",{onClick:Ve,class:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"}," Cerrar ")])])])):C("",!0)]),re.value?(l(),a("div",qt,[e("div",Ft,[s[60]||(s[60]=e("h3",{class:"text-lg font-semibold mb-4 text-gray-800"},"Crear Nuevo Usuario Interno",-1)),e("form",{onSubmit:We(Se,["prevent"]),class:"space-y-4"},[e("div",null,[s[48]||(s[48]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre Completo",-1)),P(e("input",{"onUpdate:modelValue":s[11]||(s[11]=t=>n.value.name=t),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"Ingrese el nombre completo"},null,512),[[L,n.value.name]])]),e("div",null,[s[49]||(s[49]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email",-1)),P(e("input",{"onUpdate:modelValue":s[12]||(s[12]=t=>n.value.email=t),type:"email",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"usuario@ejemplo.com"},null,512),[[L,n.value.email]])]),e("div",null,[s[52]||(s[52]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Contraseña",-1)),e("div",Gt,[P(e("input",{"onUpdate:modelValue":s[13]||(s[13]=t=>n.value.password=t),type:X.value?"text":"password",required:"",minlength:"8",class:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"Mínimo 8 caracteres"},null,8,Ht),[[Je,n.value.password]]),e("button",{type:"button",onClick:s[14]||(s[14]=t=>X.value=!X.value),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 transition-colors"},[X.value?(l(),a("svg",Ot,s[51]||(s[51]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"},null,-1)]))):(l(),a("svg",Kt,s[50]||(s[50]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])))])])]),e("div",null,[s[54]||(s[54]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Rol",-1)),P(e("select",{"onUpdate:modelValue":s[15]||(s[15]=t=>n.value.role=t),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"},s[53]||(s[53]=[e("option",{value:"empleado"},"Empleado",-1),e("option",{value:"admin"},"Administrador",-1)]),512),[[de,n.value.role]])]),e("div",Wt,[e("div",null,[s[55]||(s[55]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cargo",-1)),P(e("input",{"onUpdate:modelValue":s[16]||(s[16]=t=>n.value.cargo=t),type:"text",required:"",maxlength:"25",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"Ej: Ejecutivo de ventas, Administrador, etc."},null,512),[[L,n.value.cargo]])]),e("div",null,[s[56]||(s[56]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Teléfono",-1)),P(e("input",{"onUpdate:modelValue":s[17]||(s[17]=t=>n.value.telefono=t),type:"tel",required:"",maxlength:"8",pattern:"[0-9]{8}",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"12345678"},null,512),[[L,n.value.telefono]])])]),e("div",Jt,[e("div",Qt,[e("h4",Xt,[c(r(p),{icon:r(ke),class:"mr-2 text-green-600"},null,8,["icon"]),s[57]||(s[57]=y(" Asignar Permisos al Usuario "))]),s[58]||(s[58]=e("p",{class:"text-sm text-gray-600"}," Seleccione exactamente qué permisos tendrá este usuario. El rol es solo organizacional. ",-1))]),e("div",Yt,[s[59]||(s[59]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Permisos Disponibles: ",-1)),e("div",Zt,[S.value.length>0?(l(),a("div",eo,[(l(!0),a(E,null,U(S.value,t=>(l(),a("div",{key:t.id,class:I(["flex items-center p-2 rounded border hover:bg-gray-100 transition-colors",n.value.selectedPermissions.includes(t.name)?"bg-green-50 border-green-200":"bg-white border-gray-200"])},[P(e("input",{id:`permission-${t.id}`,type:"checkbox",value:t.name,"onUpdate:modelValue":s[18]||(s[18]=k=>n.value.selectedPermissions=k),disabled:n.value.selectedPermissions.length===1&&n.value.selectedPermissions.includes(t.name),class:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded"},null,8,so),[[Qe,n.value.selectedPermissions]]),e("label",{for:`permission-${t.id}`,class:I(["ml-3 text-sm cursor-pointer",n.value.selectedPermissions.includes(t.name)?"text-green-800 font-medium":"text-gray-700"])},d(t.name),11,to)],2))),128))])):(l(),a("div",oo," No hay permisos disponibles "))]),e("div",lo,[e("div",ao,[e("span",ro," Permisos seleccionados: "+d(n.value.selectedPermissions.length),1),n.value.selectedPermissions.length===0?(l(),a("span",no," ⚠️ Debe seleccionar al menos un permiso ")):(l(),a("span",io," ✅ Configuración válida "))]),e("div",uo,[e("button",{type:"button",onClick:Le,class:"px-2 py-1 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",disabled:n.value.selectedPermissions.length===0}," Limpiar ",8,co),e("button",{type:"button",onClick:Ie,class:"px-2 py-1 text-xs bg-green-100 text-green-700 rounded hover:bg-green-200 transition-colors"}," Seleccionar todos ")])])])]),e("div",mo,[e("button",{type:"button",onClick:be,class:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"}," Cancelar "),e("button",{type:"submit",disabled:f.value||n.value.selectedPermissions.length===0,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},d(f.value?"Creando...":"Crear Usuario"),9,vo)])],32)])])):C("",!0),me.value?(l(),a("div",po,[e("div",go,[e("h3",xo,[c(r(p),{icon:r(ke),class:"mr-2 text-green-600"},null,8,["icon"]),s[61]||(s[61]=y(" Gestionar Permisos de Usuario "))]),e("div",fo,[e("p",bo,[s[62]||(s[62]=y("Usuario: ")),e("strong",null,d((N=m.value)==null?void 0:N.name),1)]),e("p",yo,[s[63]||(s[63]=y("Rol: ")),(l(!0),a(E,null,U((V=m.value)==null?void 0:V.roles,t=>(l(),a("span",{key:t,class:I([ee(t),"px-2 py-1 text-xs font-semibold rounded-full ml-1"])},d(t),3))),128))]),s[64]||(s[64]=e("p",{class:"text-sm text-gray-500"}," Los roles son organizacionales. Los permisos se gestionan manualmente. ",-1))]),e("div",ho,[e("div",null,[e("h4",_o,[c(r(p),{icon:r(Q),class:"mr-2 text-green-600"},null,8,["icon"]),y(" Permisos Asignados ("+d(i.value.length)+") ",1)]),i.value.length>0?(l(),a("div",wo,[(l(!0),a(E,null,U(i.value,t=>(l(),a("div",{key:t,class:"flex items-center justify-between p-2 bg-green-50 rounded border"},[e("div",ko,[c(r(p),{icon:r(Q),class:"text-green-600 mr-2"},null,8,["icon"]),e("span",Co,d(t),1)]),e("button",{onClick:k=>fe(t),disabled:f.value||i.value.length===1,class:"text-red-600 hover:text-red-800 transition-colors disabled:opacity-50",title:"Remover permiso"},[c(r(p),{icon:r(we)},null,8,["icon"])],8,Po)]))),128))])):(l(),a("div",Eo," No tiene permisos asignados ")),i.value.length===1?(l(),a("div",Uo,[c(r(p),{icon:r(ce),class:"mr-1"},null,8,["icon"]),s[65]||(s[65]=y(" No se puede eliminar el último permiso. El usuario debe tener al menos uno. "))])):C("",!0)]),e("div",null,[e("h4",Mo,[c(r(p),{icon:r(se),class:"mr-2 text-blue-600"},null,8,["icon"]),y(" Asignar Nuevos Permisos ("+d(M.value.length)+") ",1)]),M.value.length>0?(l(),a("div",Ao,[(l(!0),a(E,null,U(M.value,t=>(l(),a("div",{key:t.id,class:"flex items-center justify-between p-2 bg-gray-50 rounded border hover:bg-gray-100 transition-colors"},[e("span",jo,d(t.name),1),e("button",{onClick:k=>xe(t),disabled:f.value,class:"text-blue-600 hover:text-blue-800 transition-colors disabled:opacity-50",title:"Asignar permiso"},[c(r(p),{icon:r(se)},null,8,["icon"])],8,$o)]))),128))])):(l(),a("div",Ro," No hay permisos adicionales disponibles "))])]),e("div",zo,[e("button",{onClick:De,class:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",disabled:f.value},d(f.value?"Procesando...":"Cerrar"),9,No)])])])):C("",!0),Y.value?(l(),a("div",Vo,[e("div",Do,[e("div",To,[e("div",Lo,[c(r(p),{icon:r(ce),class:"h-6 w-6 text-amber-500 mr-3"},null,8,["icon"]),s[66]||(s[66]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Cambios sin guardar",-1))]),s[67]||(s[67]=e("p",{class:"text-gray-600 mb-6"}," Hay cambios sin guardar. ¿Deseas salir? Se perderán los datos que modificaste. ",-1)),e("div",Io,[e("button",{onClick:s[19]||(s[19]=t=>Y.value=!1),class:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors"}," Seguir Editando "),e("button",{onClick:ie,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors"}," Salir sin Guardar ")])])])])):C("",!0)]}),_:1})}}};export{Ko as default};
