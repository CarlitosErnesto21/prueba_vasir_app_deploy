import{_ as q}from"./Catalogo-By4UlWAU.js";import H from"./FiltrosPanel-ZxuV8ZX-.js";import K from"./SearchBar-BnuoJi1w.js";import Q from"./ProductGrid-CPYcMq3M.js";import W from"./PaginationControls-5jOS60KC.js";import X from"./EmptyState-CvRlSCsc.js";import Y from"./ModalAuthRequerido-BKiGMHZP.js";import Z from"./CarritoCompras-CjEy1hnc.js";import ee from"./CarritoButton-GmFSSaHi.js";import{a4 as ae,r,o as te,N as U,E as f,w as D,k as oe,h as re,d as se,x as ie,p as n,e as i}from"./vendor-BOi6Gr0G.js";import{z as le}from"./ui-BibPgP1I.js";import{u as ne}from"./carrito-C3CkmCNo.js";import"./logo-DN1bLr27.js";import"./index-Btbp3Gjs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./app-DQ6NqA0X.js";const ce={class:"bg-gradient-to-br from-gray-50 via-blue-50/30 to-red-50/30 min-h-screen pt-20 sm:pt-20 md:pt-28 lg:pt-32 xl:pt-32"},ue={class:"w-full px-1 sm:px-2 lg:px-2 pb-4 sm:pb-4 lg:pb-4"},de={class:"mb-3 sm:mb-4"},me={class:"bg-gradient-to-br from-white via-blue-50 to-red-50 rounded-xl shadow-xl border border-gray-200 overflow-hidden"},ve={class:"bg-gradient-to-r from-red-600 via-red-500 to-blue-600 text-white text-center py-4 sm:py-6 relative"},pe={class:"absolute top-4 right-4"},ge={class:"flex flex-col lg:flex-row gap-4 lg:gap-8"},fe={class:"flex-1"},Ue={__name:"Tienda",setup(Pe){const d=le(),w=ae(),x=ne(),m=r([]),F=r([]),P=r(!0),_=r(!0),b=r(!1),T=r(null),l=r([]),c=r(""),u=r(""),v=r(""),S=r(!1),s=r(1),p=r(8);r(0),te(async()=>{await Promise.all([$(),N()]),x.verificarEstadoAutenticacion(),L()});const L=()=>{var t;if(!((t=w.props.auth)==null?void 0:t.user))return;const e=sessionStorage.getItem("producto_compra_pendiente"),o=sessionStorage.getItem("compra_session_activa");if(e&&o)try{const h=JSON.parse(e),I=m.value.find(R=>R.id===h.productoId);I&&(sessionStorage.removeItem("producto_compra_pendiente"),sessionStorage.removeItem("compra_session_activa"),setTimeout(()=>{E(I)},1e3))}catch(h){console.error("Error al procesar producto pendiente:",h),sessionStorage.removeItem("producto_compra_pendiente"),sessionStorage.removeItem("compra_session_activa")}},$=async()=>{try{P.value=!0;const a=await U.get("/api/productos");m.value=(a.data.data||a.data||[]).map(e=>{var o;return{id:e.id,nombre:e.nombre,descripcion:e.descripcion,precio:parseFloat(e.precio),stock_actual:e.stock_actual,categoria:((o=e.categoria)==null?void 0:o.nombre)||"Sin categoría",categoria_id:e.categoria_id,imagen:e.imagenes&&e.imagenes.length>0?typeof e.imagenes[0]=="string"?e.imagenes[0]:e.imagenes[0].nombre:null,imagenes:e.imagenes||[]}}).filter(e=>e.stock_actual>0)}catch(a){console.error("Error al cargar productos:",a),d.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los productos",life:3e3})}finally{P.value=!1}},N=async()=>{try{_.value=!0;const a=await U.get("/api/categorias-productos");F.value=(a.data.data||a.data||[]).map(e=>({id:e.id,nombre:e.nombre,cantidad:0}))}catch(a){console.error("Error al cargar categorías:",a),d.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categorías",life:3e3})}finally{_.value=!1}},z=f(()=>F.value.map(a=>({...a,cantidad:m.value.filter(e=>e.categoria===a.nombre).length})).filter(a=>a.cantidad>0)),g=f(()=>{let a=[...m.value];if(v.value){const e=v.value.toLowerCase();a=a.filter(o=>o.nombre.toLowerCase().includes(e)||o.descripcion.toLowerCase().includes(e)||o.categoria.toLowerCase().includes(e))}return l.value.length>0&&(a=a.filter(e=>l.value.includes(e.categoria))),c.value&&!isNaN(c.value)&&(a=a.filter(e=>e.precio>=parseFloat(c.value))),u.value&&!isNaN(u.value)&&(a=a.filter(e=>e.precio<=parseFloat(u.value))),a}),y=f(()=>Math.ceil(g.value.length/p.value)),k=f(()=>{const a=(s.value-1)*p.value,e=a+p.value;return g.value.slice(a,e)}),A=f(()=>{if(m.value.length===0)return{min:0,max:0,promedio:0};const a=m.value.map(e=>e.precio);return{min:Math.min(...a),max:Math.max(...a),promedio:a.reduce((e,o)=>e+o,0)/a.length}}),B=a=>{const e=l.value.indexOf(a);e>-1?l.value.splice(e,1):l.value.push(a),s.value=1},M=()=>{l.value=[],c.value="",u.value="",v.value="",s.value=1,d.add({severity:"info",summary:"Filtros limpiados",detail:"Se han removido todos los filtros",life:2e3})},G=()=>{s.value=1,d.add({severity:"success",summary:"Filtros aplicados",detail:`Mostrando ${g.value.length} productos`,life:2e3})},C=a=>{a>=1&&a<=y.value&&(s.value=a)},V=()=>{s.value>1&&C(s.value-1)},j=()=>{s.value<y.value&&C(s.value+1)};D(v,()=>{s.value=1}),D([c,u],()=>{s.value=1});const E=a=>{var o;if(a.stock_actual<=0){d.add({severity:"warn",summary:"Sin stock",detail:`El producto "${a.nombre}" no está disponible`,life:3e3});return}if(!((o=w.props.auth)==null?void 0:o.user)){T.value=a,b.value=!0;return}x.agregarProducto(a),setTimeout(()=>{x.mostrarCarrito()},500)},O=a=>{d.add({severity:"info",summary:"Detalles del producto",detail:`${a.nombre} - $${a.precio.toFixed(2)} - ${a.categoria} - Stock: ${a.stock_actual}`,life:5e3})},J=async()=>{await Promise.all([$(),N()]),d.add({severity:"success",summary:"Datos actualizados",detail:"La información se ha actualizado correctamente",life:2e3})};return(a,e)=>{const o=oe("Toast");return se(),re(q,null,{default:ie(()=>[n(o,{class:"z-[9999]"}),i("div",ce,[i("div",ue,[i("div",de,[i("div",me,[i("div",ve,[i("div",pe,[n(ee)]),e[8]||(e[8]=i("h1",{class:"text-2xl sm:text-3xl md:text-4xl font-bold mb-2"},"🛍️ Productos",-1)),e[9]||(e[9]=i("p",{class:"text-base sm:text-lg text-red-100 px-4"},"Encuentra los mejores productos para tu viaje",-1))])])]),i("div",ge,[n(H,{categories:z.value,selectedCategories:l.value,minPrice:c.value,maxPrice:u.value,showMobileFilters:S.value,loadingCategories:_.value,preciosStats:A.value,"onUpdate:selectedCategories":e[0]||(e[0]=t=>l.value=t),"onUpdate:minPrice":e[1]||(e[1]=t=>c.value=t),"onUpdate:maxPrice":e[2]||(e[2]=t=>u.value=t),"onUpdate:showMobileFilters":e[3]||(e[3]=t=>S.value=t),onToggleCategory:B,onClearFilters:M,onApplyPriceFilter:G},null,8,["categories","selectedCategories","minPrice","maxPrice","showMobileFilters","loadingCategories","preciosStats"]),i("div",fe,[n(K,{searchTerm:v.value,allFilteredProducts:g.value,selectedCategories:l.value,minPrice:c.value,maxPrice:u.value,"onUpdate:searchTerm":e[4]||(e[4]=t=>v.value=t)},null,8,["searchTerm","allFilteredProducts","selectedCategories","minPrice","maxPrice"]),n(Q,{loading:P.value,filteredProducts:k.value,onComprarProducto:E,onVerDetalles:O},null,8,["loading","filteredProducts"]),n(W,{currentPage:s.value,totalPagesComputed:y.value,allFilteredProducts:g.value,itemsPerPage:p.value,"onUpdate:currentPage":e[5]||(e[5]=t=>s.value=t),"onUpdate:itemsPerPage":e[6]||(e[6]=t=>p.value=t),onGoToPage:C,onGoToPreviousPage:V,onGoToNextPage:j},null,8,["currentPage","totalPagesComputed","allFilteredProducts","itemsPerPage"]),n(X,{loading:P.value,filteredProducts:k.value,products:m.value,onClearFilters:M,onRecargarDatos:J},null,8,["loading","filteredProducts","products"])])])])]),n(Y,{visible:b.value,"onUpdate:visible":e[7]||(e[7]=t=>b.value=t),productoInfo:T.value},null,8,["visible","productoInfo"]),n(Z)]),_:1})}}};export{Ue as default};
